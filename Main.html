<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Gesti√≥nG - Control de Finanzas</title>
</head>
<body>
    <script>
        (async function verificarSesion() {
            try {
                // Si el servidor no reconoce al usuario, mandar√° un error 401
                const response = await fetch('https://gestiong-production.up.railway.app/obtener-gastos', {
                    credentials: 'include'
                });

                if (response.status === 401) {
                    window.location.href = 'index.html'; // Lo saca si no est√° logueado
                }
            } catch (error) {
                console.error("Error de conexi√≥n:", error);
            }
        })();
    </script>
    <!-- Encabezado principal -->
    <header>
        Gesti√≥n de cuentas - <small id="nombre-usuario-display">Cargando...</small>
    </header>

    <main class="dashboard">
        <!-- ============================================
             COLUMNA IZQUIERDA - Resumen y entradas
             ============================================ -->
        <div class="columna-izquierda">
            
            <!-- Secci√≥n de resumen: muestra los c√°lculos -->
            <section id="resumenes">
                <h3>Tu resumen</h3>
                <p>Sueldo: <span id="Mostrar-sueldo">0</span> COP</p>   
                <p>Ahorro Quincenal (10%): <span id="Ahorro-quincenal">0</span> COP</p>
                <p>Valor por clase: <span id="valor-clase">0</span> COP</p>
            </section>

            <!-- Entradas de informaci√≥n b√°sica -->
            <section id="ingresos">
                <h3>Datos de ingresos</h3>
                <input type="number" id="num-clases" placeholder="N√∫mero de clases dadas">
                <input type="number" id="CopQuincenal" placeholder="Sueldo en pesos">
                
                <textarea id="desc-ingreso" placeholder="Descripcion del ingreso (Ej: Bono Extra)" rows="2"></textarea>
            </section>
            
            <button id="botonGuardar">Guardar</button>
            <br><br><br>

            <!--Grafico de gastos-->
            <section id="contenedor-grafico">
                <h3>Distribuci√≥n de Gastos</h3>
                <canvas id="graficoGastos"></canvas>
            </section>

        </div>
        <!-- ============================================
             COLUMNA DERECHA - Planificador de gastos
        ============================================ -->
        <div class="columna-derecha">
            <section id="horario-gastos">
                <h2>Planificador de Gastos</h2>
                
                <!-- Gastos que son todos los meses -->
                <div class="seccion-gastos">
                    <h3>Gastos Fijos y Agenda</h3>
                    
                    <div class="fila-gasto">
                        <input type="date" id="fecha-gasto-real">
                        <input type="number" id="valor-gasto-real" placeholder="Monto $">
                    </div>

                    <div class="fila-gasto">
                        <textarea id="desc-gasto" placeholder="¬øEn qu√© consisti√≥ este gasto?" rows="2" style="width: 100%;"></textarea>
                    </div>
                </div>

                <!-- Gastos variables del d√≠a a d√≠a -->
                <div class="seccion-gastos">
                    <h3>Gastos Variables</h3>
                    <input type="number" id="gasto-compras" placeholder="Mercado/D√≠a a d√≠a">
                    <input type="number" id="gasto-antojos" placeholder="Antojos y salidas">
                </div>

                <!-- Seguimiento de deudas -->
                <div class="seccion-gastos">
                    <h3>Deudas</h3>
                    <input type="number" id="deuda-corto" placeholder="Celular (Corto plazo)">
                    <input type="number" id="deuda-largo" placeholder="Largo plazo">
                </div>

                <button id="botonCalcularGastos">Calcular Gastos</button>
            </section>

            <!-- Aqu√≠ se mostrar√° el calendario de pagos -->
            <section id="lista-proximos-pagos">
                <!--Contenedor flexible para t√≠tulo y bot√≥n de exportar-->
                <div class="header-historial">
                    <h2>Agenda de Pagos Quincenal</h2>
                    <button id="boton-exportar">Exportar</button>
                </div>
                
                <section id="seccion-historial">
                    <h2>Pesta√±a de Historial</h2>
                    <div id="contenedor-historial">
                        <table id = "tabla-historial">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Descrici√≥n</th>
                                    <th>Costo</th>
                                    <th>Prioridad</th>
                                    <th>Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpo-historial">
                                <tr>
                                    <td colspan="3" class="texto-centrado">A√∫n no hay registros en el historial.</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <!-- Resumen del total acumulado -->
                         <div class="caja-total">
                            <strong>Total gastado: </strong>
                            <span id="total-gastado">$0</span>
                         </div>
                    <button id="botonBorrarHistorial" style="background-color: #dc3545;">Borrar Historial</button>
                </section>
                <div id="contenedor-agenda">
                    <p>Ingresa los datos y dale a "Calcular Gastos" para ver tu agenda.</p>
                </div>
            </section>
        </div>
    </main>
    <!--Contenedor para notificaciones flotantes-->
    <div id="notificacion-container" class="notificacion-hidden">
        <span id="notificacion-mensaje"></span>
    </div>

    <!--Modal de borrar historial-->
    <div id="custom-modal" class="modal-hidden">
        <div class="modal-content">
            <h3>¬øEst√°s seguro?</h3>
            <p id="modal-texto">Esta acci√≥n no se podra deshacer.</p>
            <div class="modal-actions">
                <button id="modal-confirmar" class="btn-danger">Confirmar</button>
                <button id="modal-cancelar" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>
    <!--Modal informativo-->
    <div id="modal-notificacion" class="modal-hidden">
        <div class="modal-content notificacion-card">
            <div id="icono-notificacion">‚úÖ</div>
            <p id="mensaje-notificacion-modal"></p>
            <button id="btn-cerrar-notif" class="boton-primario">Entendido</button>
        </div>
    </div>
    <!--Modal de eliminacion individual-->
    <div id="modal-confirmar-eliminar" class="modal-hidden">
        <div class="modal-content notification-card">
            <div style="font-size: 50px;">üóëÔ∏è</div>
            <p>¬øEst√°s seguro de que quieres eliminar este gasto?</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button id="btn-si-eliminar" class="btn-danger">S√≠, borrar</button>
                <button id="btn-no-eliminar" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>
    
    <!--Llamado del grafico-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script> <!--Estamos descargandola desde la pagina cdn.jsdelivr.net-->

    <!--Llamado del script-->
    <script src="script.js"></script>
    
</body>

